version: '3.8'

services:
  # ── Memgraph (Same as Production) ──────────────────────────────────────────────
  memgraph:
    image: memgraph/memgraph:latest
    platform: linux/amd64
    container_name: dexpi-memgraph-dev
    ports:
      - "7687:7687"
      - "7444:7444"
    volumes:
      - memgraph-data-dev:/var/lib/memgraph
    environment:
      - MEMGRAPH_HOST=memgraph
      - MEMGRAPH_PORT=7687

  # ── Next.js App (Development Mode) ─────────────────────────────────────────────
  app:
    # Use standard Node image instead of building production info
    image: node:20-buster
    container_name: dexpi-equipment-factory-dev
    working_dir: /app
    
    # Mount local directory to container for hot-reload
    volumes:
      - ./:/app
      - /app/node_modules
    
    # Run Next.js dev server
    command: npm run dev
    
    ports:
      - "3000:3000"
    
    environment:
      - GEMINI_API_KEY=${GEMINI_API_KEY}
      - MEMGRAPH_HOST=memgraph
      - MEMGRAPH_PORT=7687
      - PORT=3000
    
    depends_on:
      - memgraph

volumes:
  memgraph-data-dev:
